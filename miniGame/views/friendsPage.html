<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Freinds page</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <% if (error) { %>
    <div class="popup-error"><%= error %></div>
    <script>
      setTimeout(() => {
        const popup = document.querySelector('.popup-error');
        if (popup) popup.style.display = 'none';
      }, 3000);
    </script>
  <% } %>
  <header class="top-bar">
    <div class="app-title">Freinds page</div>
    <a href="/mainPage" class="btn link">Back</a>
  </header>

  <main class="main-content">
    <section>
      <h2>Add a friend!</h2>
      <form action="/friends/add" method="post">
  <input type="text" name="username" placeholder="Uživatelské jméno" required />
  <button type="submit" class="btn">Add</button>
</form>
    </section>

    <section>
      <h2>Friendship requests</h2>
      <% if (friendRequests.length === 0) { %>
        <p>No new requests.</p>
      <% } else { %>
        <ul class="request-list">
          <% friendRequests.forEach(request => { %>
            <li>
              <img src="/profile_pics/<%= request.profilePicture %>" alt="avatar" class="avatar" width="32" height="32" style="vertical-align:middle; margin-right:8px;">
              <span><%= request.username %></span>

              <form action="/friends/accept/<%= request.username %>" method="post" style="display:inline">
                <button type="submit" class="btn small">Accept</button>
              </form>

              <form action="/friends/decline/<%= request.username %>" method="post" style="display:inline">
                <button type="submit" class="btn small danger">Declime</button>
              </form>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </section>

    <section>
      <h2>Friends list</h2>
      <% if (friends.length === 0) { %>
        <p>You have no friends :(</p>
      <% } else { %>
        <ul class="friend-list">
          <% friends.forEach(friend => { %>
            <li>
              <img src="/profile_pics/<%= friend.profilePicture || 'dog.png' %>" alt="avatar" class="avatar" width="32" height="32" style="vertical-align:middle; margin-right:8px;">
              <span><%= friend.username %></span>

              <form action="/friends/delete/<%= friend.username %>" method="post" style="display:inline">
                <button type="submit" class="btn small danger">Remove</button>
              </form>

              <form action="/scoreboard/mutual" method="get" style="display:inline">
                <input type="hidden" name="friendId" value="<%= friend.id %>" />
                <button type="submit" class="btn small">Scoreboard</button>
              </form>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </section>
  </main>
</body>
</html>