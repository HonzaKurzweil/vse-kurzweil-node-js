<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Testovací Aplikace</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <header class="top-bar">
   
     <div id="activePlayers"><%- include('_activePlayers.html') %></div>

    <a href="/logout" class="btn">Odhlásit se</a>
  </header>

  <main class="main-content">

    <div id="sendGameRequestSection"><%- include('_sendGameRequest.html') %></div>
     <a href="/friendsPage" class="btn">Friends</a>
         <div id="receiveGameRequest"><%- include('_receiveGameRequest.html') %></div>


  </main>

  <script>
   const ws = new WebSocket("ws://localhost:3000/ws")
 
   ws.addEventListener("message", (event) => {
    console.log('received event', event.data)
    let data;
    try {
      data = JSON.parse(event.data)
    } catch (e) {
      console.log('Failed to parse ws message:', event.data, e);
      return;
    }
    console.log('Parsed ws message:', data);
    const {type, html} = data;
    if (type === "activePlayers") {
      const el = document.getElementById("activePlayers")
      el.innerHTML = html
    }
    if (type === "gameRequest") {
      const el1 = document.getElementById("sendGameRequestSection")
      el1.innerHTML = html
    }
    if (data.type === 'newGameRequest') {
      console.log('Handling newGameRequest:', data);
      if (window.gameRequests && window.renderGameRequests) {
        window.gameRequests.push({
          sender: data.sender,
          game: { id: data.gameId, type: data.gameType }
        });
        window.renderGameRequests();
        console.log('Added new game request and re-rendered.');
      } else {
        console.log('gameRequests or renderGameRequests not found on window.');
      }
    }
   })
</script>
</body>
</html>
